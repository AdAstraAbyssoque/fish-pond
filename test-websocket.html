<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WebSocket æµ‹è¯•</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        #status {
            font-size: 24px;
            margin: 20px 0;
            padding: 10px;
            border: 2px solid #00ff00;
        }
        #data {
            background: #000;
            padding: 10px;
            margin-top: 20px;
            border: 1px solid #333;
            max-height: 400px;
            overflow-y: auto;
        }
        .connected { color: #00ff00; }
        .disconnected { color: #ff0000; }
        .connecting { color: #ffaa00; }
    </style>
</head>
<body>
    <h1>WebSocket ä¼ æ„Ÿå™¨è¿æ¥æµ‹è¯•</h1>
    <div id="status" class="connecting">â³ æ­£åœ¨è¿æ¥...</div>
    <button onclick="reconnect()">é‡æ–°è¿æ¥</button>
    <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    
    <h3>å®æ—¶æ•°æ®ï¼š</h3>
    <div id="data"></div>

    <script>
        const WEBSOCKET_URL = 'ws://localhost:8765';
        let ws = null;
        let dataDiv = document.getElementById('data');
        let statusDiv = document.getElementById('status');
        
        function log(message, color = '#00ff00') {
            const line = document.createElement('div');
            line.style.color = color;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            dataDiv.insertBefore(line, dataDiv.firstChild);
            
            // é™åˆ¶æœ€å¤šæ˜¾ç¤º 50 æ¡
            if (dataDiv.children.length > 50) {
                dataDiv.removeChild(dataDiv.lastChild);
            }
        }
        
        function connect() {
            log('æ­£åœ¨è¿æ¥åˆ° ' + WEBSOCKET_URL, '#ffaa00');
            statusDiv.textContent = 'â³ æ­£åœ¨è¿æ¥...';
            statusDiv.className = 'connecting';
            
            try {
                ws = new WebSocket(WEBSOCKET_URL);
                
                ws.onopen = () => {
                    log('âœ… WebSocket è¿æ¥æˆåŠŸï¼', '#00ff00');
                    statusDiv.textContent = 'ğŸŸ¢ å·²è¿æ¥';
                    statusDiv.className = 'connected';
                };
                
                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        const msg = `AccX: ${data.x?.toFixed(3)}, AccY: ${data.y?.toFixed(3)}, AccZ: ${data.z?.toFixed(3)} | å¼ºåº¦: ${data.magnitude?.toFixed(3)}g | çŠ¶æ€: ${data.phase}`;
                        log(msg, '#00ddff');
                    } catch (error) {
                        log('âŒ è§£ææ•°æ®å¤±è´¥: ' + error.message, '#ff0000');
                    }
                };
                
                ws.onerror = (error) => {
                    log('âŒ WebSocket é”™è¯¯: ' + error, '#ff0000');
                    statusDiv.textContent = 'ğŸ”´ è¿æ¥é”™è¯¯';
                    statusDiv.className = 'disconnected';
                };
                
                ws.onclose = () => {
                    log('ğŸ”´ WebSocket è¿æ¥å·²å…³é—­', '#ff9900');
                    statusDiv.textContent = 'ğŸ”´ å·²æ–­å¼€';
                    statusDiv.className = 'disconnected';
                    
                    // 5ç§’åè‡ªåŠ¨é‡è¿
                    setTimeout(() => {
                        log('å°è¯•é‡æ–°è¿æ¥...', '#ffaa00');
                        connect();
                    }, 5000);
                };
                
            } catch (error) {
                log('âŒ åˆ›å»ºè¿æ¥å¤±è´¥: ' + error.message, '#ff0000');
                statusDiv.textContent = 'ğŸ”´ è¿æ¥å¤±è´¥';
                statusDiv.className = 'disconnected';
            }
        }
        
        function reconnect() {
            if (ws) {
                ws.close();
            }
            setTimeout(connect, 100);
        }
        
        function clearLog() {
            dataDiv.innerHTML = '';
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿æ¥
        connect();
    </script>
</body>
</html>

